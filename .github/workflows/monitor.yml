name: ä¸œæ¨ªInn ç›‘æ§ (02-21)

on:
  schedule:
    - cron: '*/30 * * * *'  # æ¯30åˆ†é’Ÿè‡ªåŠ¨è¿è¡Œä¸€æ¬¡ (é¢‘ç‡å¯è°ƒ)
  workflow_dispatch:        # å…è®¸æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®æµ‹è¯•

jobs:
  check_room:
    runs-on: ubuntu-latest
    steps:
      - name: è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: å®‰è£…ä¾èµ–åº“
        run: pip install requests beautifulsoup4

      - name: è¿è¡Œç›‘æ§è„šæœ¬
        # ä¸‹é¢è¿™æ®µæ˜¯å†…åµŒçš„ Python ä»£ç 
        run: |
          python -c "
          import requests
          from bs4 import BeautifulSoup
          import sys
          import time

          # ç›®æ ‡: 2026-02-21, 00104åº—, 2äºº
          URL = 'https://www.toyoko-inn.com/china_cn/search/result/room_plan/?hotel=00104&people=2&room=1&smoking=all&start=2026-02-21&end=2026-02-22'
          
          print(f'æ­£åœ¨æ£€æŸ¥: {URL}')
          
          headers = {
              'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
          }

          try:
              response = requests.get(URL, headers=headers, timeout=30)
              print(f'çŠ¶æ€ç : {response.status_code}')
              
              if response.status_code != 200:
                  print('âŒ è®¿é—®å¤±è´¥ï¼Œå¯èƒ½è¢«æ‹¦æˆª')
                  sys.exit(1)

              soup = BeautifulSoup(response.text, 'html.parser')
              
              # æ ¸å¿ƒé€»è¾‘: æŸ¥æ‰¾æ˜¯å¦æœ‰é¢„è®¢é“¾æ¥
              # ä¸œæ¨ªå®˜ç½‘æœ‰æˆ¿æ—¶ï¼Œä¼šæœ‰ href åŒ…å« /reserve/input çš„é“¾æ¥
              booking_links = soup.find_all(lambda tag: tag.name == 'a' and tag.get('href') and '/reserve/input' in tag.get('href'))
              
              if booking_links:
                  print('\n' + '='*30)
                  print('ğŸ‰ å‘ç°ç©ºæˆ¿ï¼(Found Room)')
                  print(f'æ‰¾åˆ° {len(booking_links)} ä¸ªå¯é¢„è®¢æˆ¿å‹')
                  print('='*30 + '\n')
                  # è¿™é‡Œå¯ä»¥è®© GitHub Action æ ‡è®°ä¸ºæˆåŠŸï¼Œæˆ–è€…è§¦å‘åç»­é€šçŸ¥
              else:
                  print('ğŸ˜´ æš‚æ—¶æ— æˆ¿ (No rooms available)')
                  
          except Exception as e:
              print(f'âŒ è„šæœ¬å‡ºé”™: {e}')
              sys.exit(1)
          "
